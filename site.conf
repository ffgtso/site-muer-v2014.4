--[[	gluon site.conf example

		This file is loosely related to the original site.conf used in Lübeck.
		There are comments added to most switches to explain the usage of gluon.

	This is lua code now, not perl anymore.

	Happy compiling!
]]

{
	-- A new node's name will be autogenerated from
	-- it's primary MAC address and this prefix.
	-- e.g. freifunk-0123456789ab
	hostname_prefix = 'muer',

	-- name of this community
	site_name = 'Freifunk Müritz',
	-- short name of this community
	site_code = 'mueritz',

	-- v4 and v6 prefixes in which nodes+clients might get an IP
	prefix4 = '10.169.0.0/21',
	prefix6 = 'fd42:ffee:ff12:0aff::/64',

	-- timezone
	timezone = 'CET-1CEST,M3.5.0,M10.5.0/3', -- Europe/Berlin

	-- network-internal ntp service
	ntp_servers = {'ntp.services.mueritz', 'pool.ntp.org'},

	-- regulatory domain of your wifi
	regdom = 'DE',

	-- wifi settings (2.4 GHz and 5 GHz)
	-- the most important thing to change is the SSID
	-- of the client network (yourcity.freifunk.net) and
	-- both(!) mesh_?ssid ad-hoc mesh network ids.
	wifi24 = {
		ssid = 'mueritz.freifunk.net',
		channel = 5,
		htmode = 'HT40-',
		mesh_ssid = '00:23:de:ca:fb:ad',
		mesh_bssid = '00:23:de:ca:fb:ad',
		mesh_mcast_rate = 12000,
	},
	wifi5 = {
		ssid = 'mueritz.freifunk.net',
		channel = 44,
		htmode = 'HT40+',
		mesh_ssid = '00:23:de:ca:fb:ad',
		mesh_bssid = '00:23:de:ca:fb:ad',
		mesh_mcast_rate = 12000,
	},

	-- IP address of each router
	-- At this IP a client can always connect to its
	-- currently connected node. Both v4 and v6 addr.
	-- must lie in the above prefix4 and prefix6.
	next_node = {
		ip4 = '10.169.0.1',
		ip6 = 'fd39:e4e3:eee1:::1',

		-- mac address, must be unique in the client network
		-- (usually, you don't need to change this)
		mac = 'de:ca:fb:ad:ff:fe',
	},

	-- fastd (vpn) settings
	fastd_mesh_vpn = {
		-- cipher(s) to use
		methods = {'salsa2012+umac'},

		-- the maximum transfer unit
		-- use 1426 for IPv4 gateways
		mtu = 1406,

		backbone = {
			-- specifies how many servers are contacted
			-- by a client simultanously
			limit = 2,

			-- list all available vpn servers
			peers = {
				gw01 = {
					key = '2ddba2fe0ed61615016cbbbd71ca1afcc7432dd8eb81c1e18806bcbb766b72b3',
					remotes = {'"gw01.4830.org" port 10169'},
				},
				gw02 = {
					key = 'ee0902a7452d017cd154005e10944dcb278d648776988922d52b960e05d49780',
					remotes = {'"gw02.4830.org" port 10169'},
				},
				gw03 = {
					key = '40343e165e102f65513b5ddb2eb855289fc2e353af672fbe8924627acc2bf8ce',
					remotes = {'"gw03.4830.org" port 10169'},
				},
				gw05 = {
					key = '7f94344fa80d5ec144c14db366712a0cf34f420571cbe4e1025a3f23a88474cb',
					remotes = {'"gw05.4830.org" port 10169'},
				},
				gw06 = {
					key = 'be56eb2cb9493f22b6e0cce4c7f8c838fd44e8c44c6983c58265bbe1c2cf04c0',
					remotes = {'"gw06.4830.org" port 10169'},
				},
			},
		},
	},

	-- configure the autoupdater
	autoupdater = {
		enabled = 1,

		-- default branch for a firmware
		-- In config-mode, the user can select a different branch from below
		branch = 'stable',

		-- available branches for the autoupdater
		branches = {
			stable = {
				-- visible name of this branch (why not use the internal identifier here, too)
				name = 'stable',

				-- where to get the manifest file (without the trailing /manifest)
				-- It's wise to use an internal address here,
				-- but specifying a publicly available update site does not hurt.
				mirrors = {'http://firmware.mueritz/stable/sysupgrade', 'http://firmware.ip4.mueritz.4830.org/stable/sysupgrade', 'http://firmware.ip6.mueritz.4830.org/stable/sysupgrade'},
				-- A node rolls the dice once per hour - with
				-- this probably the dice says "go check if there is new firmware"
				-- A value of 8% (0.08) means that we estimate a update check every 12-13 hours (100/8=12.5).
				probability = 0.25,

				-- Number of valid manifest signatures necessary to accept the manifest as "good".
				good_signatures = 2,

				-- list of public keys which are considered "good" for manifest signatures
				pubkeys = {
					'fbc997a8fd3b7372b3044cf855c660f70b0f713f8ab1dca4b9a1ae297c8f5588', -- FFGT builder
					'a7ac1e48f4459a995cf6bcd8d3668ca26cf36a1fe5981ddfca93d4c04632deeb', -- wusel
					'3c09bcf54e9c2d244d7888c9d2bdea08b2f2dc249deda23ef8194a114be85390', -- QA1
					'f3a88717ce7ec8250b40191edf088d6f30b9179ad7ec80a8e14abfd270ff8770', -- QA2
				},
			},
			testing = {
				name = 'testing',
				mirrors = {'http://firmware.mueritz/testing/sysupgrade', 'http://firmware.ip4.mueritz.4830.org/testing/sysupgrade', 'http://firmware.ip6.mueritz.4830.org/testing/sysupgrade'},
				probability = 0.25,
				good_signatures = 1,
				pubkeys = {
					'fbc997a8fd3b7372b3044cf855c660f70b0f713f8ab1dca4b9a1ae297c8f5588', -- FFGT builder
					'a7ac1e48f4459a995cf6bcd8d3668ca26cf36a1fe5981ddfca93d4c04632deeb', -- wusel
					'3c09bcf54e9c2d244d7888c9d2bdea08b2f2dc249deda23ef8194a114be85390', -- QA1
					'f3a88717ce7ec8250b40191edf088d6f30b9179ad7ec80a8e14abfd270ff8770', -- QA2
				},
			},
			experimental = {
				name = 'experimental',
				mirrors = {'http://firmware.mueritz/experimental/sysupgrade', 'http://firmware.ip4.mueritz.4830.org/experimental/sysupgrade', 'http://firmware.ip6.mueritz.4830.org/experimental/sysupgrade'},
				probability = 0.25,
				good_signatures = 1,
				pubkeys = {
					'fbc997a8fd3b7372b3044cf855c660f70b0f713f8ab1dca4b9a1ae297c8f5588', -- FFGT builder
					'a7ac1e48f4459a995cf6bcd8d3668ca26cf36a1fe5981ddfca93d4c04632deeb', -- wusel
					'3c09bcf54e9c2d244d7888c9d2bdea08b2f2dc249deda23ef8194a114be85390', -- QA1
					'f3a88717ce7ec8250b40191edf088d6f30b9179ad7ec80a8e14abfd270ff8770', -- QA2
				},
			},
		},
	},

	-- default traffic shaping (bandwidth limit) settings
	simple_tc = {
		mesh_vpn = {
			ifname = 'mesh-vpn',
			enabled = false,
			limit_egress = 500,
			limit_ingress = 8000,
		},
	},

	-- custom messages in config mode
	config_mode = {
		msg_welcome = [[
Willkommen zum Einrichtungsassistenten f&uuml;r deinen neuen M&uuml;ritzer
Freifunk-Knoten. F&uuml;lle das folgende Formular deinen Vorstellungen
entsprechend aus und sende es ab.
]],
		msg_pubkey = [[
Dies ist der &ouml;ffentliche Schl&uuml;ssel deines Freifunkknotens. Bitte
benutze das
<a href="http://setup.guetersloh.freifunk.net/nodereg.php?key=<%=pubkey%>&hostname=<%=hostname%>&mac=<%=sysconfig.primary_mac%>&coords=<%=location%>"
target="_blank">vorausgef&uuml;llte Formular</a>, <strong>falls</strong> Dein Knoten aktuell keinen Internetzugang hat. Eigentlich macht der Knoten das im Hintergrund selbstätig. Du kannst dieses Fenster auch offen lassen, dann sollte Dein Browser in 90 Sekunden jene Seite automatisch aufrufen. Und nicht
wegen der URL wundern, Freifunk M&uuml;ritz wird derzeit von Freifunk G&uuml;tersloh technisch unterst&uuml;tzt.
]],
		msg_reboot = [[
<p>
Dein Knoten startet gerade neu und wird anschlie&szlig;end versuchen,
sich mit Freifunk M&uuml;ritz-Knoten und/oder -Gateways zu verbinden. <br>&nbsp;<br>
<b>Bitte denke daran, daß bei Freifunk-Knoten mit blauen und gelben
Netzwerkbuchsen AB JETZT das Netzwerkkabel in der BLAUEN Buchse stecken mu&szlig;!</b><br>&nbsp;<br>
Weitere Informationen zur M&uuml;ritzer Freifunk-Community findest du auf
<a href="http://mueritz.freifunk.net/">unserer Webseite</a>.
</p>
<p>
Viel Spa&szlig; mit deinem Knoten und der Erkundung von Freifunk!
</p>
]],
	},
}
